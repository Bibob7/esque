dist: xenial
language: python
cache: pip
env:
- TEST_CMD="pytest tests/ --integration"
before_install:
- wget https://mirror.netcologne.de/apache.org/kafka/2.2.0/kafka_2.12-2.2.0.tgz -O kafka.tgz
- mkdir -p kafka && tar xzf kafka.tgz -C kafka --strip-components 1
- nohup bash -c "cd kafka && bin/zookeeper-server-start.sh config/zookeeper.properties  &"
- nohup bash -c "cd kafka && bin/kafka-server-start.sh config/server.properties &"
- scripts/wait-for-it.sh localhost:9092
- scripts/wait-for-it.sh localhost:2181
install:
- pip install coverage coveralls flake8 pipenv
- pipenv install --system --dev --deploy
script:
- "$TEST_CMD"
after_success:
- coveralls
notifications:
  on_success: change
  on_failure: always
  slack:
    secure: gKnYxnBbzm8Y1rWKJUwq8vnTI2d48RwMDsDwcy9FROqK5N8nlWfVZiGI7tKZsz213m9Yq/aI/P1iR880sfh9636/R/Q2XzXqbt0h4VF/yXujocWOlcOncCcPQMgbpXlmgawLrRPf8FRRmEyRbZzT1Cyv17SJONKLDBgqy4sqdIlRI1uC+Zfqn1XBFK0iNvwVMvzWDoz25jfktUc4c0x1Z8y3G09G3Xe8t0U7ocbVLKkuLkdV3/I3TMgr2jjJQshXI69SwSjZxdm18gEiB6A9z9WFVAomwQ7lW6ThcLcDGpE5YZJkoxJ7VKGMjxOY/f3tiYx3ub2a3KvHhnJpS0Bp0ZN5qs/vGNDm3xBB9/+VpFBclVi3rlq+VvYGjK33MQDPxDHTwz19UQiO9ykg+FQQBpyZfXlYSv2/PtDTYeZ4eVU7xJ+x/6+Lyf3D3ssbRJWvx0wIBiXmjjP/+uJDzXwnPVPp9ilzQmOIIC5IFkX4lQMsQcHjHEpxMCwiO076igdlfKGfmEssyyy16aOLGOxZ/c6nf/rYouxA+qTCosqvKDwdXA/kTI/X0LKePiiP7qw69mGmDb4Hje996uVVfvXdUj+EoTZhBPU9OJz1+GEUaHkSVlqXki7+7VE0pwmDhTdCmCbNusM0ZHm2URRTb1ayKFkuhMZXsYv9LvXuaLzPJ70=
matrix:
  include:
  - name: black
    python: 3.7
    env:
    - TEST_CMD="black --check --verbose ."
  - name: flake8
    python: 3.7
    env:
    - TEST_CMD="flake8 esque/*.py"
  - name: '3.6'
    python: 3.6
  - name: '3.7'
    python: 3.7
deploy:
  provider: pypi
  user: real.digital
  on:
    tags: true
  password:
    secure: L7lAviuPS2FijT/t01t0SVHuxfl3/6jcSU3anWkcJdWsa9ktujvdJ6QoX0VE+niUyAwnJ6HJUNWloG1EuuRPiaVO+vIU0t39oKtP/3KKGz6zQPme4p0tpgxvPCjxzBxlaj3zs+3KlfqT7ig5EllgLcAkyCmMpvYgpPY8pCsIY/ipZ+zzQvrA9glCQex9LPhdWH7yaHgx9eGM/dQumn9J/+/CtEkbxLpmw/WHRahCgoODFBMQjTQsVleiHZqedx7gQsSD7lqbdsUkBujawdYIrGnBVIjMdqXT7nQPbKmntKf+5GMcPdFaOqgciQYYgIRLixP1JWPoHzTvsmp0Jfmd8/4u4Eh/zLOKjdsdlNk/X2hNYae+YvKXMSwYqY33cDezsIpkvbz+Vfu3Ch97c2pmp3pSTTkcxKMqnoQJ3aqZENveCPOgfb3PSrzwYBKENaFLZ45l9eU1CPgCNNa7oX/CA1+kb1wY6AMCLW4ZxOe4I3EoUpNyn4lOIEkeOsHIB5d9DJvphd5UrFgUdnADzsnAsr38Gq+Haz9YmaXscUIRvQR27HDqCwfsSn9XPkdwImIjzhPrgM5kGXm0UPsf7nGZiYwEuB2fDTji4YneDhCF4aCKzr7Txlo1BtWp5ue6kbjCARBkwgCO/uHkl8AYos/tUmZe6vl6p3kwYf8sl3i9bOs=
